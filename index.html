<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Recipe Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-lg">
      <h1 class="text-2xl font-bold text-center mb-4">
        Global Recipe Explorer
      </h1>
      <div class="mb-4">
        <input
          type="text"
          id="input"
          placeholder="Enter ingredients or cuisine (e.g., chicken, rice or Indian)"
          class="w-full p-2 border rounded mb-2"
        />
        <button
          id="searchBtn"
          class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
        >
          Find Recipes
        </button>
      </div>
      <div id="result" class="text-center">
        <p id="error" class="text-red-500 hidden">
          No recipes found. Try different inputs.
        </p>
        <div id="recipeData" class="hidden">
          <h2 class="text-xl font-semibold mb-2">Recipes</h2>
          <div id="recipes"></div>
        </div>
      </div>
    </div>
    <script>
      const spoonacularApiKey = "866d7b6857374d03a0d23e4faf3a0d50"; // Replace with your Spoonacular API key
      const unsplashAccessKey = "wp-uamutzRS4XSXShtAHTbUwBNsW_KXKeFEKT56JpY4"; // Replace with your Unsplash Access Key
      const searchBtn = document.getElementById("searchBtn");
      const input = document.getElementById("input");
      const result = document.getElementById("result");
      const error = document.getElementById("error");
      const recipeData = document.getElementById("recipeData");
      const recipesDiv = document.getElementById("recipes");

      searchBtn.addEventListener("click", () => {
        const query = input.value.trim();
        if (query) {
          findRecipes(query);
        } else {
          showError("Please enter ingredients or a cuisine.");
        }
      });

      async function findRecipes(query) {
        try {
          // Determine if input is a cuisine (single word/phrase) or ingredients (multiple words with commas)
          const words = query.split(",").map((word) => word.trim());
          const isCuisine = words.length === 1 && !query.includes(",");

          let endpoint = "";
          let recipes = [];
          if (isCuisine) {
            // Use complexSearch for cuisine
            endpoint = `https://api.spoonacular.com/recipes/complexSearch?query=${encodeURIComponent(
              query
            )}&cuisine=${encodeURIComponent(
              query
            )}&number=5&apiKey=${spoonacularApiKey}`;
            const response = await fetch(endpoint);
            if (!response.ok) throw new Error("API request failed");
            const data = await response.json();
            recipes = data.results || [];
          } else {
            // Use findByIngredients for multiple ingredients
            endpoint = `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${encodeURIComponent(
              words.join(",")
            )}&number=5&apiKey=${spoonacularApiKey}`;
            const response = await fetch(endpoint);
            if (!response.ok) throw new Error("API request failed");
            const data = await response.json();
            recipes = data.map((item) => ({
              title: item.title,
              usedIngredients: item.usedIngredients,
              sourceUrl: item.sourceUrl,
            }));
          }

          if (recipes.length === 0) {
            throw new Error("No recipes found");
          }

          // Fetch an image from Unsplash for the query
          const imageUrl = await fetchImage(query);

          displayRecipes(recipes, imageUrl, query);
          error.classList.add("hidden");
          recipeData.classList.remove("hidden");
        } catch (err) {
          console.error("Error fetching recipes:", err);
          showError("No recipes found. Try different inputs.");
        }
      }

      async function fetchImage(query) {
        try {
          const response = await fetch(
            `https://api.unsplash.com/search/photos?query=${encodeURIComponent(
              query + " food"
            )}&per_page=1&client_id=${unsplashAccessKey}`
          );
          if (!response.ok) throw new Error("Image unavailable");
          const data = await response.json();
          return (
            data.results[0]?.urls?.regular || "https://via.placeholder.com/300"
          );
        } catch (err) {
          console.error("Error fetching image:", err);
          return "https://via.placeholder.com/300";
        }
      }

      function displayRecipes(recipes, imageUrl, query) {
        recipesDiv.innerHTML = "";
        const imgDiv = document.createElement("div");
        imgDiv.className = "mb-4";
        imgDiv.innerHTML = `<img src="${imageUrl}" alt="${query} food" class="w-full h-48 object-cover rounded">`;
        recipesDiv.appendChild(imgDiv);

        recipes.forEach((recipe) => {
          const recipeDiv = document.createElement("div");
          recipeDiv.className = "border p-4 mb-2 rounded text-left";
          recipeDiv.innerHTML = `
          <h3 class="font-semibold">${recipe.title || "Untitled Recipe"}</h3>
          <p>Ingredients: ${
            recipe.usedIngredients?.map((i) => i.name).join(", ") || "N/A"
          }</p>
          <a href="${
            recipe.sourceUrl || "#"
          }" target="_blank" class="text-blue-500 hover:underline">View Recipe</a>
        `;
          recipesDiv.appendChild(recipeDiv);
        });
      }

      function showError(message) {
        error.textContent = message;
        error.classList.remove("hidden");
        recipeData.classList.add("hidden");
      }
    </script>
  </body>
</html>
